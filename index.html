<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="./style.css" type="text/css" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
      integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog=="
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css"
    />

    <title>Travel Helper (가제)</title>
  </head>

  <body>
    <header>
      <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
          <a class="navbar-brand fw-bold" href="#">
            <img
              src="./logo.png"
              alt=""
              width="30"
              height="30"
              class="d-inline-block align-text-top me-1"
            />
            Travel Helper
          </a>
        </div>
      </nav>
      <!--Title Area-->
      <div class="container" id="title_container">
        <div class="item" id="title_input">
          <input
            class="form-control form-control-lg"
            type="text"
            placeholder="Enter trip title"
            aria-label=".form-control-lg example"
          />
        </div>

        <div class="item" id="date_input">
          <input
            class="form-control form-control-sm"
            type="text"
            id="demo"
            name="demo"
            value=""
            aria-label=".form-control-sm example"
          />
        </div>

        <div class="item" id="cpn_input">
          <input
            class="form-control form-control-sm"
            type="text"
            placeholder="김XX, 이XX, 박XX"
            aria-label=".form-control-sm example"
          />
        </div>
      </div>
    </header>
    <main>
      <!--Showing total Budget-->
      <div
        class="
          container
          p-1
          rounded-3
          ps-2
          d-flex
          justify-content-between
          align-items-center
        "
        id="total_budget_container"
      >
        <div class="d-flex align-items-center" id="total_buget_text_area">
          <!--this text should be set whenever budget list is changed-->
          <h4 id="total_text">Total:</h4>
          <h4 id="total_cost">0</h4>
          <h4 id="budget_text">/ Budget:</h4>
          <h4 id="budget_cost">0</h4>
          <h2 id="currency">$</h2>
        </div>
        <div id="btns_total_budget">
          <button type="button" class="btn btn-warning" id="btn_mode">
            <i class="fas fa-exchange-alt"></i>
          </button>
          <button type="button" class="btn me-auto bg-primary" id="btn_dollar">
            should be changed to select
          </button>
        </div>
      </div>
      <!--Main Plan Area-->
      <div
        class="
          plan
          container
          d-flex
          align-items-strech
          flex-column
          bg-light
          rounded-3
        "
        id="plan_container_1"
      >
        <div class="d-flex align-items-baseline ms-1" id="plan_date_area">
          <p class="fw-bold fs-3">|</p>
          <p class="fs-4 date text" id="day_date_text">10.XX</p>
          <input
            class="bg-light fw-bold fs-5"
            id="day_title_input"
            type="text"
            placeholder="day title"
          />
        </div>

        <div
          class="d-flex flex-fill align-items-strech px-2"
          id="list_map_area"
        >
          <div class="d-flex flex-column flex-grow-1 w-50" id="lists_area">
            <div class="flex-grow-1 h-50 rounded-2" id="plan_list_area">
              <div class="d-flex align-items-baseline" id="plan_input_area">
                <h6 class="fw-bold ms-1">PLAN</h6>
                <input
                  type="text"
                  class="bg-light flex-fill"
                  id="plan_input"
                  placeholder="Text here"
                />
                <button type="button" class="btn" id="btn_add">
                  <i class="bi bi-plus-lg"></i>Add
                </button>
              </div>

              <div class="p-1 ms-1" id="plan_list">
                <div class="task sample d-flex align-items-center m-1">
                  <span class="me-auto">Sample plan</span>
                  <button class="btn btn-danger me-1" id="btn_smp_remove">
                    <i class="bi bi-x"></i>
                  </button>
                  <button class="btn" id="btn_gps">
                    <i class="bi bi-geo-alt-fill"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="flex-grow-1 h-50 rounded-2" id="budget_list_area">
              <!--Fill budget list here-->
              budget
            </div>
          </div>

          <div class="bg-secondary rounded-2 flex-grow-1 w-50" id="map_area">
            <!--Fill map here-->
            map
          </div>
        </div>
      </div>
      <div class="clone container" id="clone"></div>
    </main>
    <footer></footer>

    <script>
      /*plan list add button*/
      let btn_add = document.querySelector("#btn_add");
      btn_add.addEventListener("click", () => {
        let plan_input = document.querySelector("#plan_input");
        let text = plan_input.value;

        if (!text.length) return;

        let task = {
          text: text,
          location: "",
        };

        addToList(task);

        plan_input.value = "";
      });

      function addToList(task) {
        let div = document.createElement("div");
        div.classList.add("task", "d-flex", "align-items-center", "m-1");

        let span = document.createElement("span");
        span.className = "me-auto";
        span.textContent = task.text;
        div.appendChild(span);

        /*plan list remove button*/
        let btn_remove = document.createElement("button");
        btn_remove.className = "btn btn-danger me-1";
        btn_remove.innerHTML = '<i class="bi bi-x"></i>';
        div.appendChild(btn_remove);

        btn_remove.addEventListener("click", () => {
          div.remove();
        });

        let btn_gps = document.createElement("button");
        btn_gps.className = "btn";
        btn_gps.id = "btn_gps";
        btn_gps.innerHTML = '<i class="bi bi-geo-alt-fill"></i>';
        div.appendChild(btn_gps);

        let planList = document.querySelector("#plan_list");
        planList.appendChild(div);
      }

      /*remove sample*/
      let btn_smp_remove = document.querySelector("#btn_smp_remove");
      btn_smp_remove.addEventListener("click", () => {
        let div = document.querySelector(".task.sample");
        div.remove();
      });

      /*gps button popup*/
      let btn_gps = document.querySelector("#btn_gps");
      btn_gps.addEventListener("click", () => {
        window.open(
          "./pop_up.html",
          "address_input",
          "width=400, height=100, left=500, top=350"
        );
      });
    </script>

    <!--DO NOT TOUCH-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"
    />

    <script type="text/javascript">
      let st, ed;

      $("#demo").daterangepicker(
        {
          locale: {
            format: "YYYY-MM-DD",
            separator: " ~ ",
            applyLabel: "확인",
            cancelLabel: "취소",
            fromLabel: "From",
            toLabel: "To",
            customRangeLabel: "Custom",
            weekLabel: "W",
            daysOfWeek: ["일", "월", "화", "수", "목", "금", "토"],
            monthNames: [
              "1월",
              "2월",
              "3월",
              "4월",
              "5월",
              "6월",
              "7월",
              "8월",
              "9월",
              "10월",
              "11월",
              "12월",
            ],
          },
          startDate: new Date(),
          endDate: new Date(),
          drops: "down",
        },
        function (start, end, label) {
          let dateText = document.querySelector(".date.text");
          if (dateText !== "10.XX") {
            $("#clone").empty();
          }

          st = start.format("YYYY-MM-DD");
          ed = end.format("YYYY-MM-DD");
          console.log(st + " to " + ed);

          let st_date, ed_date;
          st_date = st.split("-");
          ed_date = ed.split("-");

          let i = 1,
            st_mon = +st_date[1],
            st_day = +st_date[2],
            ed_mon = +ed_date[1],
            ed_day = +ed_date[2],
            day_range = [],
            mon_range = [];

          //case of changed month
          if (st_mon !== ed_mon) {
            if (
              st_mon === 1 ||
              st_mon === 3 ||
              st_mon === 5 ||
              st_mon === 7 ||
              st_mon === 8 ||
              st_mon === 10 ||
              st_mon === 12
            ) {
              while (ed_day + 1 !== i) {
                while (st_day <= 31) {
                  day_range.push(st_day++);
                  mon_range.push(st_mon);
                }
                day_range.push(i++);
                mon_range.push(ed_mon);
              }
            } else if (st_mon === 2) {
              while (ed_day + 1 !== i) {
                while (st_day <= 28) {
                  day_range.push(st_day++);
                  mon_range.push(st_mon);
                }
                day_range.push(i++);
                mon_range.push(ed_mon);
              }
            } else {
              while (ed_day + 1 !== i) {
                while (st_day <= 30) {
                  day_range.push(st_day++);
                  mon_range.push(st_mon);
                }
                day_range.push(i++);
                mon_range.push(ed_mon);
              }
            }
          }
          //case of same month
          else {
            while (st_day !== ed_day + 1) {
              day_range.push(st_day++);
              mon_range.push(st_mon);
            }
          }
          console.log("day_range: ", day_range);
          console.log("mon_range: ", mon_range);

          if (day_range.length - 1) {
            for (let i = 0; i < day_range.length - 1; i++) {
              $("#plan_container_1")
                .clone()
                .appendTo(".clone")
                .prop("id", "plan_container_" + (i + 2));
            }
          }

          i = 0;
          document.querySelectorAll(".date.text").forEach((date) => {
            if (st_mon !== ed_mon) {
            }
            date.textContent = mon_range[i] + "." + day_range[i];
            i++;
          });

          day_range = [];
          mon_range = [];
        }
      );
    </script>
  </body>
</html>
